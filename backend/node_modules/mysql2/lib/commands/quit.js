'use strict';

const Command = require('mysql2/lib/commands/command.js');
const CommandCode = require('mysql2/lib/constants/commands.js');
const Packet = require('mysql2/lib/packets/packet.js');

class Quit extends Command {
  constructor(callback) {
    super();
    this.done = callback;
  }

  start(packet, connection) {
    connection._closing = true;
    const quit = new Packet(
      0,
      Buffer.from([1, 0, 0, 0, CommandCode.QUIT]),
      0,
      5
    );
    if (this.done) {
      this.done();
    }
    connection.writePacket(quit);
    return null;
  }
}

module.exports = Quit;
